{"version":3,"sources":["src/globals.ts","src/dom.ts","src/scales.ts","src/osc.ts","src/events.ts","src/index.ts"],"names":[],"mappings":"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","file":"src.5616f4e9.js","sourceRoot":"..","sourcesContent":["export const ctx = new window.AudioContext()\r\nexport const gain = ctx.createGain()\r\ngain.connect(ctx.destination)\r\n","const g = (id: string) => {\r\n  const node = document.getElementById(id)\r\n\r\n  if (!node) {\r\n    throw new Error('Element not found')\r\n  }\r\n\r\n  return node\r\n}\r\n\r\nexport const h = (tag: string): HTMLElement => document.createElement(tag)\r\n\r\nexport const Nodes = {\r\n  playChord: g('play-chord'),\r\n  volume: g('volume'),\r\n  oscs: g('oscs'),\r\n}\r\n","export const getJustIntonation = (freq: number): number[] => [\r\n  freq * 1,\r\n  freq * (9 / 8),\r\n  freq * (5 / 4),\r\n  freq * (4 / 3),\r\n  freq * (3 / 2),\r\n  freq * (5 / 3),\r\n  freq * (15 / 8),\r\n]\r\n\r\nexport const getPythagoreanIntonation = (freq: number): number[] => [\r\n  freq * 1,\r\n  freq * (9 / 8),\r\n  freq * (81 / 64),\r\n  freq * (4 / 3),\r\n  freq * (3 / 2),\r\n  freq * (27 / 16),\r\n  freq * (243 / 128),\r\n]\r\n\r\nexport const getEqualTemperamentIntonation = (freq: number): number[] => [\r\n  freq * 1,\r\n  freq * 1.122462,\r\n  freq * 1.259921,\r\n  freq * 1.33484,\r\n  freq * 1.498307,\r\n  freq * 1.587401,\r\n  freq * 1.887749,\r\n]\r\n\r\nexport const getOctavesFromIntonation = (freqs: number[]): number[][] => {\r\n  const octaves = []\r\n  for (let i = 0; i < 5; i++) {\r\n    const octave = freqs.reduce<number[]>((memo, freq) => {\r\n      return [...memo, freq * (i + 1)]\r\n    }, [])\r\n    octaves.push(octave)\r\n  }\r\n  return octaves\r\n}\r\n\r\nexport const getDefaultOctaves = (): number[] => [\r\n  16.35, 17.32, 18.35, 19.45, 20.6, 21.83, 23.12, 24.5, 25.96, 27.5, 29.14,\r\n  30.87, 32.7, 34.65, 36.71, 38.89, 41.2, 43.65, 46.25, 49, 51.91, 55, 58.27,\r\n  61.74, 65.41, 69.3, 73.42, 77.78, 82.41, 87.31, 92.5, 98, 103.83, 110, 116.54,\r\n  123.47, 130.81, 138.59, 146.83, 155.56, 164.81, 174.61, 185, 196, 207.65, 220,\r\n  233.08, 246.94, 261.63, 277.18, 293.66, 311.13, 329.63, 349.23, 369.99, 392,\r\n  415.3, 440, 466.16, 493.88, 523.25, 554.37, 587.33, 622.25, 659.25, 698.46,\r\n  739.99, 783.99, 830.61, 880, 932.33, 987.77, 1046.5, 1108.73, 1174.66,\r\n  1244.51, 1318.51, 1396.91, 1479.98, 1567.98, 1661.22, 1760, 1864.66, 1975.53,\r\n  2093, 2217.46, 2349.32, 2489.02, 2637.02, 2793.83, 2959.96, 3135.96, 3322.44,\r\n  3520, 3729.31, 3951.07, 4186.01, 4434.92, 4698.63, 4978.03, 5274.04, 5587.65,\r\n  5919.91, 6271.93, 6644.88, 7040, 7458.62, 7902.13,\r\n]\r\n\r\nexport const getMajorScale = (): number[] => [\r\n  32.7, 36.71, 41.2, 43.65, 49, 55, 61.74, 65.41, 73.42, 82.41, 87.31, 98, 110,\r\n  123.47, 130.81, 146.83, 164.81, 174.61, 196, 220, 246.94, 261.63, 293.66,\r\n  329.63, 349.23, 392, 440, 493.88, 523.25, 587.33, 659.25, 698.46, 783.99, 880,\r\n  987.77, 1046.5, 1174.66, 1318.51, 1396.91, 1567.98, 1760, 1975.53, 2093,\r\n  2349.32, 2637.02, 2793.83, 3135.96, 3520, 3951.07, 4186.01, 4698.63, 5274.04,\r\n  5587.65, 6271.93, 7040, 7902.13,\r\n]\r\n","import { Nodes, h } from './dom'\r\nimport { ctx, gain } from './globals'\r\nimport { getMajorScale } from './scales'\r\n\r\nfunction createNoteOsc(freq: number, index: number) {\r\n  let isPlaying = false\r\n  let isMouseDown = false\r\n  let paint = false\r\n  const volume = 0.3\r\n\r\n  const container = h('div')\r\n  container.classList.add('note')\r\n  if (index % 7 === 0) {\r\n    container.classList.add('root')\r\n  }\r\n\r\n  const oscs = Nodes.oscs\r\n\r\n  const oscCtrl = h('div')\r\n  oscCtrl.classList.add('osc-ctrl')\r\n\r\n  const volumeCtrl = h('div')\r\n  volumeCtrl.classList.add('volume')\r\n  container.appendChild(volumeCtrl)\r\n  container.appendChild(oscCtrl)\r\n\r\n  let osc: OscillatorNode\r\n  const oscGain = ctx.createGain()\r\n  oscGain.gain.value = volume\r\n  oscGain.connect(gain)\r\n\r\n  const stop = () => {\r\n    if (osc) {\r\n      osc.stop()\r\n    }\r\n    oscCtrl.classList.remove('playing')\r\n  }\r\n\r\n  const start = () => {\r\n    // const sineTerms = new Float32Array([0, 1, 0.05, 0, 0.01, 0.01, 0.005]);\r\n    const sineTerms = new Float32Array([0, 1])\r\n    const cosineTerms = new Float32Array(sineTerms.length)\r\n    const customWaveform = ctx.createPeriodicWave(cosineTerms, sineTerms)\r\n    osc = ctx.createOscillator()\r\n    osc.setPeriodicWave(customWaveform)\r\n    osc.frequency.setValueAtTime(freq, ctx.currentTime)\r\n    osc.connect(oscGain)\r\n    osc.start()\r\n    oscCtrl.classList.add('playing')\r\n  }\r\n\r\n  const calculateVolume = (offsetY: number) => {\r\n    const perceptionProportion = 1 / ((index + 1) * 1.1)\r\n    // console.log(perceptionProportion);\r\n    const maxHeight = parseInt(getComputedStyle(oscCtrl).height, 10)\r\n    const volume = Math.min(\r\n      ((maxHeight - offsetY) / maxHeight) * perceptionProportion,\r\n      1\r\n    )\r\n    oscGain.gain.value = volume\r\n    volumeCtrl.style.height = maxHeight - offsetY + 'px'\r\n  }\r\n  \r\n  oscs.addEventListener('mousedown', () => {\r\n    paint = true\r\n  })\r\n\r\n  oscs.addEventListener('mouseup', () => {\r\n    paint = false\r\n  })\r\n\r\n  oscCtrl.addEventListener('dblclick', () => {\r\n    calculateVolume(300)\r\n  })\r\n\r\n  oscCtrl.addEventListener(\"mousedown\", (e: MouseEvent) => {\r\n    calculateVolume(e.offsetY)\r\n    if (!isPlaying) {\r\n      start()\r\n      isPlaying = true\r\n    }\r\n  })\r\n  \r\n  oscCtrl.addEventListener('mousemove', (e: MouseEvent) => {\r\n    if (paint) {\r\n      calculateVolume(e.offsetY)\r\n      if(!isPlaying){\r\n        start()\r\n        isPlaying = true\r\n      }\r\n    }\r\n  })\r\n\r\n  Nodes.oscs.appendChild(container)\r\n\r\n  return () => {\r\n    stop()\r\n  }\r\n}\r\n\r\nexport function playNotes(): () => void {\r\n  // const C2 = 65.41;\r\n  // const G1 = 49;\r\n\r\n  // const notes = getOctavesFromIntonation(getEqualTemperamentIntonation(G1))\r\n  // .reduce((memo, octave) => [...memo, ...octave], [])\r\n\r\n  const notes = getMajorScale().map((note, i) => createNoteOsc(note, i))\r\n\r\n  return () => {\r\n    notes.forEach((remove) => remove())\r\n    Nodes.oscs.innerHTML = ''\r\n  }\r\n}\r\n","import { Nodes } from './dom'\r\nimport { gain } from './globals'\r\nimport { playNotes } from './osc'\r\n\r\nlet stop: () => unknown = () => undefined\r\n\r\n// eslint-disable-next-line @typescript-eslint/ban-ts-comment\r\n// @ts-ignore\r\ngain.gain.value = Nodes.volume.value\r\n\r\nNodes.playChord.addEventListener('click', () => {\r\n  stop()\r\n  Nodes.oscs.innerHTML = ''\r\n  stop = playNotes()\r\n})\r\n\r\nNodes.volume.addEventListener('change', (e) => {\r\n  // eslint-disable-next-line @typescript-eslint/ban-ts-comment\r\n  // @ts-ignore\r\n  gain.gain.value = e.target?.value\r\n})\r\n\r\nstop = playNotes()\r\n","import './globals'\r\nimport './events'\r\n"]}